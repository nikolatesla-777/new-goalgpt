import{r as t}from"./react-vendor-y4dMEW91.js";const _=()=>typeof window<"u"&&window.location.hostname!=="localhost"?`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`:"ws://localhost:3000/ws";function G(g={}){const{onScoreChange:f,onDangerAlert:w,onGoalCancelled:h,onMatchStateChange:E,onMinuteUpdate:m,onPredictionSettled:p,onAnyEvent:A}=g,[I,C]=t.useState(!1),[y,D]=t.useState(null),[N,S]=t.useState(new Map),s=t.useRef(null),d=t.useRef(null),a=t.useRef(0),M=10,n=t.useRef({onScoreChange:f,onDangerAlert:w,onGoalCancelled:h,onMatchStateChange:E,onMinuteUpdate:m,onPredictionSettled:p,onAnyEvent:A});t.useEffect(()=>{n.current={onScoreChange:f,onDangerAlert:w,onGoalCancelled:h,onMatchStateChange:E,onMinuteUpdate:m,onPredictionSettled:p,onAnyEvent:A}},[f,w,h,E,m,p,A]);const u=t.useRef(new Map),k=t.useCallback(l=>{try{const r=JSON.parse(l.data),e=r.data||r;if(!e.type)return;switch(D(e),n.current.onAnyEvent?.(e),e.type){case"SCORE_CHANGE":n.current.onScoreChange?.(e),S(i=>{const c=new Map(i);return c.delete(e.matchId),c});break;case"DANGER_ALERT":const o=e;n.current.onDangerAlert?.(o),S(i=>{const c=new Map(i);return c.set(o.matchId,o),c});const b=u.current.get(o.matchId);b&&clearTimeout(b);const x=setTimeout(()=>{S(i=>{const c=new Map(i);return c.delete(o.matchId),c}),u.current.delete(o.matchId)},1e4);u.current.set(o.matchId,x);break;case"GOAL_CANCELLED":n.current.onGoalCancelled?.(e);break;case"MATCH_STATE_CHANGE":n.current.onMatchStateChange?.(e);break;case"MINUTE_UPDATE":n.current.onMinuteUpdate?.(e);break;case"PREDICTION_SETTLED":n.current.onPredictionSettled?.(e);break}}catch{}},[]),T=t.useCallback(()=>{if(s.current?.readyState!==WebSocket.OPEN)try{const l=_(),r=new WebSocket(l);s.current=r,r.onopen=()=>{C(!0),a.current=0},r.onmessage=k,r.onerror=()=>{},r.onclose=()=>{if(C(!1),s.current=null,a.current<M){const e=Math.min(1e3*Math.pow(2,a.current),3e4);d.current=setTimeout(()=>{a.current++,T()},e)}}}catch{}},[k]),R=t.useCallback(()=>{d.current&&(clearTimeout(d.current),d.current=null),a.current=M,s.current&&(s.current.close(),s.current=null),C(!1)},[]);return t.useEffect(()=>(T(),()=>{R(),u.current.forEach(l=>clearTimeout(l)),u.current.clear()}),[]),{isConnected:I,lastEvent:y,dangerAlerts:N,connect:T,disconnect:R}}export{G as u};
